## HTTP 캐시의 동작 원리

### **HTTP 캐시의 원리**

HTTP 캐시는 클라이언트와 서버 간의 데이터 전송을 최적화하고, 서버 부하를 줄이며, 사용자의 경험을 향상시키는 중요한 기술입니다. 캐시는 데이터나 리소스를 클라이언트나 중간 서버에 저장하여 동일한 데이터를 반복적으로 요청할 때 서버에 대한 요청을 줄이고 응답 시간을 단축시킵니다. HTTP 캐시는 **브라우저 캐시**, **프록시 캐시**, **CDN 캐시** 등 다양한 방식으로 작동할 수 있습니다.

캐시의 목적은 클라이언트가 자주 요청하는 리소스를 서버로부터 반복적으로 다운로드할 필요 없이 저장된 캐시에서 직접 제공하여 성능을 개선하는 것입니다.

---

### **Cache-Control 헤더**

- **목적**: HTTP 응답에 대한 캐시 정책을 정의하는 헤더로, 클라이언트와 서버 간의 캐시 동작을 제어합니다.
- **역할**: 클라이언트에게 리소스를 캐시할지, 얼마나 오래 캐시할지 등을 지시합니다. `Cache-Control` 헤더는 여러 가지 지시어를 포함할 수 있습니다.
- **주요 지시어**:
    - `no-cache`: 리소스를 캐시하지만, 사용하기 전에 서버로 확인해야 한다는 지시입니다.
    - `no-store`: 리소스를 캐시하지 않고, 항상 서버에서 새 데이터를 받아옵니다.
    - `max-age`: 캐시된 리소스가 유효한 최대 시간을 초 단위로 지정합니다.
    - `public`: 모든 사용자에게 리소스를 캐시할 수 있음을 나타냅니다.
    - `private`: 오직 특정 사용자만 리소스를 캐시할 수 있습니다.
- **예시**:

    ```
    Cache-Control: no-cache, max-age=3600, public
    ```

    - `no-cache`: 매번 서버에 요청을 확인해야 함
    - `max-age=3600`: 리소스는 1시간(3600초) 동안 유효
    - `public`: 모든 사용자에게 리소스를 캐시할 수 있도록 허용

---

### **Expires 헤더**

- **목적**: 리소스의 만료 시간을 지정합니다.
- **역할**: 캐시된 리소스가 만료되는 날짜와 시간을 설정합니다. 이 날짜 이후에는 리소스를 새로 요청해야 합니다. `Expires` 헤더는 **절대적인 날짜/시간**을 사용하여 만료 시간을 지정합니다.
- **예시**:

    ```
    Expires: Wed, 21 Oct 2025 07:28:00 GMT
    ```

    - 이 날짜 이후에 리소스는 만료되며, 클라이언트는 서버에 새로운 요청을 보내야 합니다.
- **주의**: `Expires`는 **절대적인 날짜**를 기준으로 하므로, 동적인 캐시 처리에 더 유연한 `Cache-Control`이 더 많이 사용됩니다.

---

### **브라우저와 서버에서 캐시가 작동하는 방식**

1. **클라이언트 요청**:
    - 클라이언트가 서버로 HTTP 요청을 보낼 때, 브라우저는 요청하는 리소스가 캐시되어 있는지 확인합니다.
    - 브라우저는 요청한 리소스의 URL에 해당하는 캐시가 존재하면 `Cache-Control`, `Expires`, `Last-Modified`, `ETag` 등의 헤더를 참조하여 유효성을 검사합니다.
2. **캐시가 유효한 경우**:
    - 캐시가 유효하다면, 서버로의 요청 없이 브라우저는 저장된 리소스를 직접 제공합니다. 이 경우 응답 시간은 빨라지고, 서버 부하는 줄어듭니다.
3. **캐시가 만료되었거나 없는 경우**:
    - 캐시가 만료되었거나 캐시가 없다면, 브라우저는 서버에 요청을 보내 새 리소스를 받습니다.
    - 서버는 `Cache-Control` 또는 `Expires` 헤더를 포함하여 응답을 반환하고, 브라우저는 해당 리소스를 캐시로 저장합니다.
4. **서버의 캐시 지시**:
    - 서버는 응답 헤더에 `Cache-Control`과 `Expires` 등을 설정하여, 클라이언트가 해당 리소스를 어떻게 캐시할지 결정합니다.

---

### **HTTP 캐시 작동 원리 다이어그램**

```
+-----------------------+
|  1. 클라이언트 요청   |
|    (브라우저)           |
+-----------------------+
           |
           v
+-----------------------+
|  2. 캐시 확인         |
|    (브라우저 캐시)     |
+-----------------------+
    |                   |
  캐시 유효               캐시 만료 또는 없음
    |                   |
    v                   v
+-----------------+   +-------------------+
| 3. 캐시된 리소스  |   | 4. 서버로 새 요청 |
|    제공         |   |                   |
+-----------------+   +-------------------+
                            |
                            v
               +------------------------+
               | 5. 서버 응답 및 캐시     |
               |    (Cache-Control, Expires) |
               +------------------------+
                            |
                            v
               +----------------------+
               | 6. 브라우저에 캐시 저장|
               +----------------------+

```

---

### **결론**

HTTP 캐시는 웹 페이지나 자원의 응답 속도를 향상시키고 서버의 부하를 줄이는 중요한 메커니즘입니다. `Cache-Control` 헤더는 캐시를 어떻게 처리할지에 대한 세부 지침을 제공하며, `Expires` 헤더는 리소스의 만료 시간을 설정합니다. 브라우저는 캐시를 유효한 경우 사용하고, 만료되거나 없는 경우 서버에 새 요청을 보냅니다. 이를 통해 효율적인 데이터 전송과 리소스 관리가 가능합니다.